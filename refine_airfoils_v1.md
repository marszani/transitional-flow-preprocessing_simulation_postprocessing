# Airfoil Mesh Refinement and Grid Generation Script

**File:** `refine_airfoils_v1.py`

## Purpose

Generate refined airfoil surface meshes at multiple refinement levels and create volume meshes using the `pyHyp` grid generator. This supports grid convergence studies by producing progressively refined meshes of an airfoil geometry.

---

## Workflow

1. **Read Airfoil Geometry:**  
   Reads the initial airfoil coordinates from a `.dat` file (e.g., `e387.dat`).

2. **Set Base Mesh Parameters (L2 level):**  
   Defines base parameters for mesh refinement including:
   - Number of trailing edge (TE) cells
   - Number of surface points
   - Number of prism layers
   - Initial spacing (`s0`)

3. **Define Refinement Levels:**  
   Three refinement scales (`refinements`) and associated level names (`L2`, `L1`, `L0`) where:
   - `L2` is the base mesh
   - `L1` and `L0` are progressively finer meshes (scaled by factors 1.0 and 2.0)

4. **Generate Surface Meshes:**  
   For each refinement level:
   - Calculate scaled parameters for surface points, TE points, layers, and initial spacing.
   - Sample airfoil surface points using a polynomial spacing function emphasizing the leading edge.
   - Save airfoil surface coordinates as `.dat` and Plot3D `.xyz` files.
   - Plot and save a 2D figure of the refined surface.

5. **Run Volume Mesh Generation (`pyHyp`):**  
   For each refinement level, configure and run `pyHyp` with:
   - Boundary conditions (farfield, symmetry)
   - Number of prism layers and spacing
   - Marching distance for extrusion
   - Save generated volume mesh as `.cgns` file.

6. **Error Handling:**  
   Print errors if mesh generation fails for any level.

---

## Dependencies

- `numpy`
- `matplotlib`
- `pyHyp`
- `prefoil` (for airfoil sampling)
- Standard libraries: `os`

---

## Input

- Airfoil `.dat` file path (hardcoded as `'./e387.dat'`).

---

## Output

- Surface mesh files in `./input` folder:
  - `.dat` airfoil coordinate files per refinement level.
  - Plot3D `.xyz` files.
  - Surface mesh plots as `.png`.
- Volume mesh files:
  - `.cgns` files generated by `pyHyp` for each refinement level.

---

## Usage

Run the script in an environment where `pyHyp` and `prefoil` are installed, and the airfoil `.dat` file is accessible at the specified path.

---

## Notes

- Uses polynomial spacing with order 8 for refined sampling.
- The marching distance for mesh extrusion is set to 20 units.
- Boundary conditions assume symmetry on jLow and jHigh edges.
- Refinement factors control mesh density for convergence studies.