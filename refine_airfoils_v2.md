# Airfoil Mesh Refinement and Volume Mesh Generation

**File:** `refine_airfoils_v2.py`

## Purpose

Generate refined airfoil surface meshes at multiple refinement levels from an input airfoil `.dat` file and create volume meshes using the `pyHyp` mesh generator. Supports grid convergence studies by producing progressively finer meshes.

---

## Input

- Airfoil geometry file: `.dat` format (hardcoded as `./sd7003.dat`).

---

## Output

- Surface mesh files in `./input` folder:
  - Refined airfoil coordinate files (`.dat`).
  - Plot3D `.xyz` files.
  - Surface mesh plots saved as `.png`.
- Volume meshes saved as `.cgns` files generated by `pyHyp`.

---

## Refinement Levels

- Three refinement scales and associated level names:
  - 0.2 × base size (`L2`)
  - 1.0 × base size (`L1`)
  - 2.0 × base size (`L0`)

Parameters (number of surface points, trailing edge points, layers, initial spacing) are scaled accordingly.

---

## Workflow

For each refinement level:

1. Sample airfoil surface points using polynomial spacing with order 8.
2. Save sampled points as `.dat` and `.xyz` files.
3. Generate and save 2D plot of the airfoil surface.
4. Configure `pyHyp` with mesh generation options:
   - Boundary conditions: symmetry on low/high j-boundaries, farfield outer face.
   - Marching grid extrusion parameters, number of prism layers, spacing.
   - Mesh smoothing and growth parameters.
5. Run `pyHyp` to generate volume mesh.
6. Save volume mesh as `.cgns` file.
7. Handle and report errors during mesh generation.

---

## Key Functions and Libraries

- `read_dat_file(filepath)`: Reads airfoil `.dat` file and extracts coordinates.
- `prefoil.Airfoil.getSampledPts(...)`: Samples refined airfoil surface points.
- `pyHyp.pyHyp`: Volume mesh generation tool.
- `matplotlib.pyplot`: Plotting airfoil geometry.

---

## Notes

- Marching extrusion distance is set to 100 units.
- Prism layers near airfoil controlled by `nConstantStart`.
- Mesh coarsening is disabled by default.
- Output directory is created if it does not exist.

---

## Dependencies

- `numpy`
- `matplotlib`
- `pyHyp`
- `prefoil`
- Python standard library: `os`

---

## Usage

Ensure the input airfoil `.dat` file is located at `./sd7003.dat`. Run the script; meshes and plots will be generated in `./input`.

